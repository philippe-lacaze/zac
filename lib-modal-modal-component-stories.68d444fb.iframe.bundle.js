(self.webpackChunkzac_ng_lib=self.webpackChunkzac_ng_lib||[]).push([[202],{"./projects/zac-ng-lib/src/lib/modal/modal.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,"html, body {\n  height: 100%;\n}\n\n.--has_modal_opened {\n  overflow: hidden;\n}\n\n.modal {\n  visibility: hidden;\n  display: flex;\n  align-items: center;\n  position: fixed;\n  z-index: 1000;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  overflow: auto;\n}\n.--has_modal_opened .modal {\n  visibility: visible;\n}\n.modal--container_content {\n  z-index: 900;\n  position: relative;\n  align-self: center;\n  display: flex;\n  flex-direction: column;\n  margin: auto;\n  background-color: white;\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./projects/zac-ng-lib/src/lib/modal/modal.component.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DemoModalContentComponent:()=>DemoModalContentComponent,DemoModalTriggerComponent:()=>DemoModalTriggerComponent,ExempleNominal:()=>ExempleNominal,__namedExportsOrder:()=>__namedExportsOrder,default:()=>modal_component_stories});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs");var modal_componentngResource=__webpack_require__("./projects/zac-ng-lib/src/lib/modal/modal.component.scss?ngResource"),modal_componentngResource_default=__webpack_require__.n(modal_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");class ModalAction{show;contentType;payload;options;constructor(options={show:!0}){Object.assign(this,options)}}var Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),first=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/first.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js");let EventTrackerService=class EventTrackerService{lastDomEvent;constructor(){this.trackEvent()}trackEvent(){const originalAddEventListener=EventTarget.prototype.addEventListener,target=this;EventTarget.prototype.addEventListener=function(type,listener,options){originalAddEventListener.call(this,type,(event=>{if(listener)return event.currentTarget&&event.currentTarget!==document.body&&event.currentTarget instanceof HTMLElement&&(target.lastDomEvent=event,globalThis.__lastDomEvent=event),"function"==typeof listener?listener.call(this,event):listener&&"function"==typeof listener.handleEvent?listener.handleEvent.call(listener,event):void 0}),options)}}static ctorParameters=()=>[]};EventTrackerService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],EventTrackerService);class BaseModalService{eventTracker=(0,core.inject)(EventTrackerService);_modalActionEvent=new Subject.B;openModalBodyClasses=["--has_modal_opened","zac-modal--is-openDialog"];get modalActionEvent(){return this._modalActionEvent}open(contentType,payload,options){const modalAction={show:!0},currentEventTarget=this.eventTracker.lastDomEvent?.target??this.eventTracker.lastDomEvent?.currentTarget;return this.updateModalActionFrom(modalAction,contentType,payload,options),this.do(modalAction),this.onModalOpen(modalAction),this.modalActionEvent.asObservable().pipe((0,filter.p)((action=>!action.show)),(0,map.T)((action=>action.payload)),(0,first.$)(),(0,tap.M)({next:v=>{this.onModalClose(),this.giveFocus(options,currentEventTarget)},error:e=>console.error("Modal error:",e)}))}giveFocus(options,currentEventTarget){setTimeout((()=>{let element;options?.returnFocusSelector&&(element=document.querySelector(options.returnFocusSelector)),!element&&currentEventTarget?element=currentEventTarget:element||(element=document.body),element?.focus()}),100)}updateModalContent(instance,payload,options){const closeMethod=instance.close;instance.close=closePayload=>{closeMethod?.call(instance,closePayload),this._modalActionEvent.next({show:!1,payload:closePayload})},payload&&(instance.modalPayload=payload),options&&Object.assign(instance,options)}updateModalActionFrom(modalAction,contentType,payload,options){null!=contentType&&(modalAction.contentType=contentType),null!=payload&&(modalAction.payload=payload),null!=options&&(modalAction.options=options)}close(payload){const modalAction={show:!1};null!=payload&&(modalAction.payload=payload),this.do(modalAction)}do(action){this.modalActionEvent.next(action)}onModalOpen(modalAction){}onModalClose(){}}let ModalService=class ModalService extends BaseModalService{constructor(){super()}onModalOpen(modalAction){document.body.classList.add(...this.openModalBodyClasses)}onModalClose(){document.body.classList.remove(...this.openModalBodyClasses)}static ctorParameters=()=>[]};ModalService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],ModalService);var takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),common_module_Dx7dWex5=__webpack_require__("./node_modules/@angular/common/fesm2022/common_module-Dx7dWex5.mjs");let DynamicModalContentComponent=class DynamicModalContentComponent{viewContainerRef;contentType;modalEvent;payload;options;modalService=(0,core.inject)(ModalService);constructor(viewContainerRef){this.viewContainerRef=viewContainerRef}ngAfterViewInit(){setTimeout((()=>this.loadComponent(this.contentType)))}loadComponent(componentType){const viewContainerRef=this.viewContainerRef;viewContainerRef.clear();const instance=viewContainerRef.createComponent(componentType).instance;this.modalService.updateModalContent(instance,this.payload,this.options)}static ctorParameters=()=>[{type:core.ViewContainerRef}];static propDecorators={contentType:[{type:core.Input}],modalEvent:[{type:core.Input}],payload:[{type:core.Input}],options:[{type:core.Input}]}};var FocusTrapDirective_1;DynamicModalContentComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"zac-dynamic-modal-content",template:"",standalone:!0,changeDetection:core.ChangeDetectionStrategy.OnPush})],DynamicModalContentComponent);let FocusTrapDirective=class FocusTrapDirective{static{FocusTrapDirective_1=this}elementRef;static TAB_KEY="Tab";element;focusableElementSelector="[tabindex]:not([tabindex='-1']), button, a, :not(zac-icon,zac-button)[name], [formControlName], input:not([tabindex='-1']), textarea:not([tabindex='-1']), select:not([tabindex='-1'])";active=(0,core.model)(!1);constructor(elementRef){this.elementRef=elementRef,this.element=elementRef.nativeElement}ngOnDestroy(){this.active.set(!1)}tabEvent(event){if(this.active()&&event.key===FocusTrapDirective_1.TAB_KEY){event.preventDefault();const focusableElements=this.element.querySelectorAll(this.focusableElementSelector);if(focusableElements&&-1!==focusableElements.length){let indexElementAyantLeFocus=this.determineIndexElementAyantLeFocus(focusableElements);void 0===indexElementAyantLeFocus&&(indexElementAyantLeFocus=-1),event.shiftKey?indexElementAyantLeFocus--:indexElementAyantLeFocus++,indexElementAyantLeFocus<0?indexElementAyantLeFocus=focusableElements.length-1:indexElementAyantLeFocus>=focusableElements.length&&(indexElementAyantLeFocus=0);const elementAyantLeFocus=focusableElements[indexElementAyantLeFocus];elementAyantLeFocus?.focus&&(console.debug("focusTrapDirective give focus on ",elementAyantLeFocus),elementAyantLeFocus.focus())}}}determineIndexElementAyantLeFocus(focusableElements){let indexElementAyantLeFocus;for(let i=0;i<focusableElements.length;++i){const item=focusableElements[i];(item===document.activeElement||item.contains(document.activeElement))&&(indexElementAyantLeFocus=i)}return indexElementAyantLeFocus}static ctorParameters=()=>[{type:core.ElementRef}];static propDecorators={focusableElementSelector:[{type:core.Input}],active:[{type:core.Input,args:[{isSignal:!0,alias:"active",required:!1}]},{type:core.Output,args:["activeChange"]}],tabEvent:[{type:core.HostListener,args:["window:keypress.tab",["$event"]]},{type:core.HostListener,args:["window:keydown.tab",["$event"]]},{type:core.HostListener,args:["window:keydown.shift.tab",["$event"]]},{type:core.HostListener,args:["window:keypress.shift.tab",["$event"]]}]}};FocusTrapDirective=FocusTrapDirective_1=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[zacFocusTrap]",standalone:!0})],FocusTrapDirective);var ModalComponent_1,autofocus_directive=__webpack_require__("./projects/zac-ng-lib/src/lib/form/autofocus/autofocus.directive.ts"),light_icon_component=__webpack_require__("./projects/zac-ng-lib/src/lib/theme/icon/light-icon.component.ts"),theme_service=__webpack_require__("./projects/zac-ng-lib/src/lib/theme/theme.service.ts"),component_icons_catalog=__webpack_require__("./projects/zac-ng-lib/src/lib/theme/component-icons-catalog.ts"),pro_light_svg_icons=__webpack_require__("./node_modules/@fortawesome/pro-light-svg-icons/index.mjs"),css_context=__webpack_require__("./projects/zac-ng-lib/src/lib/shared/css/css-context.ts");class ModalCssContext extends css_context.T{modalOverlay="modal overlay zac-modal--overlay";modalContainer="modal--container_content zac-modal--container";modalButtonClose="modal--button_close zac-modal--button-close";modalButtonCloseLabel="modal--button_close--label";iconClose="zac-icon:close"}const cssContext=new ModalCssContext;let ModalComponent=class ModalComponent{static{ModalComponent_1=this}modalService;static componentIconsCatalog=new component_icons_catalog.P1(ModalComponent_1,[pro_light_svg_icons.GRI],[pro_light_svg_icons.GRI]);static ESCAPE_KEY="Escape";static MODAL_OPTIONS_DEFAULT={closeButton:!0,backgroundClose:!0,showOnInit:!1};elementRef=(0,core.inject)(core.ElementRef);modalEvent;closeButton=ModalComponent_1.MODAL_OPTIONS_DEFAULT.closeButton;showOnInit=ModalComponent_1.MODAL_OPTIONS_DEFAULT.showOnInit;backgroundClose=ModalComponent_1.MODAL_OPTIONS_DEFAULT.backgroundClose;title=ModalComponent_1.MODAL_OPTIONS_DEFAULT.title;autofocus=!0;get cssClass(){return"modal"}modalMainContentDivId="modalMainContent";show=this.showOnInit;contentType;typePopin=ModalComponent_1.MODAL_OPTIONS_DEFAULT.typePopin;payload;unsubscribe;escapeEvent(event){event.key===ModalComponent_1.ESCAPE_KEY&&this.close()}constructor(modalService,elementRef){this.modalService=modalService,this.elementRef=elementRef,(0,core.inject)(theme_service.F).feedIconLibraryForComponent(ModalComponent_1.componentIconsCatalog)}ngOnInit(){this.unsubscribe=new Subject.B,this.createInNeededAndinitializeModalEvent()}ngOnDestroy(){this.unsubscribe.next(!0),this.unsubscribe.complete()}ngOnChanges(changes){changes.modalEvent&&changes.modalEvent.previousValue&&changes.modalEvent.previousValue.unsubscribe()}open(){this.modalEvent.next(new ModalAction({show:!0}))}close(){this.modalEvent.next(new ModalAction({show:!1}))}closeIf(event,condition){event.target===event.currentTarget&&condition&&this.close()}get modalEventEmitter(){return this.modalEvent}createInNeededAndinitializeModalEvent(){this.modalEvent||(this.modalService?this.modalEvent=this.modalService.modalActionEvent:this.modalEvent=new Subject.B),this.subscribeUntilDestroy(this.modalEvent)}subscribeUntilDestroy(observable){observable&&observable.pipe((0,takeUntil.Q)(this.unsubscribe)).subscribe(this.doModalAction.bind(this))}cdr=(0,core.inject)(core.ChangeDetectorRef);doModalAction=action=>{this.show=action.show,this.feedInstancePropertiesWhith(action),this.cdr.detectChanges()};feedInstancePropertiesWhith(action){action&&(this.show&&action.contentType?(this.contentType=action.contentType,this.payload=action.payload||null):(this.contentType=null,this.payload=null),Object.assign(this,ModalComponent_1.MODAL_OPTIONS_DEFAULT,action.options),action.options?this.options=action.options:(this.options||(this.options={}),Object.assign(this.options,ModalComponent_1.MODAL_OPTIONS_DEFAULT)),action.options?.width?this.elementRef.nativeElement.style.setProperty("--zac-modal-width",action.options.width):this.elementRef.nativeElement.style.removeProperty("--zac-modal-width"))}options;cssContext=cssContext;static ctorParameters=()=>[{type:ModalService,decorators:[{type:core.Optional}]},{type:core.ElementRef}];static propDecorators={modalEvent:[{type:core.Input}],closeButton:[{type:core.Input}],showOnInit:[{type:core.Input}],backgroundClose:[{type:core.Input}],title:[{type:core.Input}],autofocus:[{type:core.Input,args:[{transform:core.booleanAttribute}]}],cssClass:[{type:core.HostBinding,args:["attr.class"]}],escapeEvent:[{type:core.HostListener,args:["document:keydown.escape",["$event"]]}]}};ModalComponent=ModalComponent_1=(0,tslib_es6.Cg)([(0,core.Component)({selector:"zac-modal",template:'<div id="parent_{{ modalMainContentDivId }}">\n  <div\n    *ngIf="show"\n    class="{{ cssContext.modalOverlay }}"\n    (click)="closeIf($event, backgroundClose)"\n  >\n    <div\n      id="{{ modalMainContentDivId }}"\n      tabindex="-1"\n      class="{{ cssContext.modalContainer }}"\n      [attr.role]="typePopin"\n      aria-modal="true"\n      [attr.aria-label]="title"\n      [zacAutofocus]="autofocus"\n      zacFocusTrap [active]="show"\n    >\n      <button\n        *ngIf="closeButton"\n        (click)="close()"\n        class="{{ cssContext.modalButtonClose }}"\n        aria-label="fermer modale"\n      >\n        <span class="{{ cssContext.modalButtonCloseLabel }}" aria-hidden="true"\n          >Fermer</span\n        >\n        <zac-light-icon\n          iconName="close"\n          class="{{ cssContext.iconClose }}"\n        ></zac-light-icon>\n      </button>\n\n      <zac-dynamic-modal-content\n        *ngIf="contentType"\n        [contentType]="contentType"\n        [modalEvent]="modalEvent"\n        [payload]="payload"\n        [options]="options"\n      >\n      </zac-dynamic-modal-content>\n    </div>\n  </div>\n</div>\n',encapsulation:core.ViewEncapsulation.None,changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[common_module_Dx7dWex5.bT,light_icon_component.N,DynamicModalContentComponent,FocusTrapDirective,autofocus_directive.B],host:{class:"zac-modal"},styles:[modal_componentngResource_default()]})],ModalComponent);var button_component=__webpack_require__("./projects/zac-ng-lib/src/lib/button/button.component.ts"),form_field_component=__webpack_require__("./projects/zac-ng-lib/src/lib/form/form-field/form-field.component.ts"),fesm2022_forms=__webpack_require__("./node_modules/@angular/forms/fesm2022/forms.mjs");const DemoModalTriggerComponentTemplate='\n    <main class="main-container">\n\n    \x3c!-- Instance de zac-modal unique à mettre dans un composant parent de layout global,\n         par exemple AppComponent --\x3e\n    <zac-modal/>\n\n    \x3c!-- Composant parent déclenchant l\'ouverture de la modale --\x3e\n    <h2 class="zac-text:form-section-title">Composant parent</h2>\n    <section class="zac-container--bordered zac-container:blue">\n\n      <p>Contenu du composant...</p>\n\n      <zac-form-field label="Un ptit champ (cible du focus de fermeture de la modale)">\n        <input id="champ" [(ngModel)]="model.champ">\n      </zac-form-field>\n\n      <zac-form-field label="Un 2eme ptit champ">\n        <input id="champ" [(ngModel)]="model.champ2">\n      </zac-form-field>\n\n      <div class="zac-button-group">\n      \x3c!-- Bouton pour ouvrir la modale --\x3e\n      <zac-button\n        [name]="\'Primary\'"\n        label="Ouvrir la modale"\n        iconPosition="none"\n        (action)="openModal()"\n      />\n      </div>\n\n    </section>\n    </main>\n\n\n\x3c!-- Dans le contrôleur TypeScript angular du composant parent --\x3e\n<script>\n  openModal() {\n    console.log(\'openModal\');\n    this.modalService\n      .open(\n        // composant à afficher dans la modale\n        DemoModalContentComponent,\n        // payload générique de la modale, récupérable via ModalContentApi.modalPayload\n        {\n          message: \'Contenu de la modale\'\n        },\n        // options de gestion de la modale\n        {\n          title: this.title,\n          autofocus: this.autofocus,\n          closeButton: this.closeButton,\n          backgroundClose: this.backgroundClose,\n          returnFocusSelector: this.returnFocusSelector\n        }\n      )\n      .subscribe((result) => {\n        console.log(\'Résultat de la modale :\', result);\n      });\n  }\n\n<\/script>\n';let DemoModalTriggerComponent=class DemoModalTriggerComponent{closeButton;autofocus;backgroundClose;title;returnFocusSelector;modalService=(0,core.inject)(ModalService);model={champ:"",champ2:""};openModal(){console.log("openModal"),this.modalService.open(DemoModalContentComponent,{message:"Contenu de la modale"},{title:this.title,autofocus:this.autofocus,closeButton:this.closeButton,backgroundClose:this.backgroundClose,returnFocusSelector:this.returnFocusSelector}).subscribe((result=>{console.log("Résultat de la modale :",result)}))}static propDecorators={closeButton:[{type:core.Input}],autofocus:[{type:core.Input}],backgroundClose:[{type:core.Input}],title:[{type:core.Input}],returnFocusSelector:[{type:core.Input}]}};DemoModalTriggerComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"demo-modal-trigger",imports:[button_component.Q,ModalComponent,form_field_component.K,fesm2022_forms.YN],template:DemoModalTriggerComponentTemplate})],DemoModalTriggerComponent);let DemoModalContentComponent=class DemoModalContentComponent{close=()=>{}};DemoModalContentComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"demo-modal-content",template:'\n    <h2 class="zac-modal--title">{{ title }}</h2>\n    <section class="zac-modal--content">\n      <p>{{ modalPayload.message }}</p>\n    </section>\n    <div class="zac-button-group">\n      <zac-button name="Valider" (action)="close(\'Bye bye\')" />\n    </div>\n  ',imports:[button_component.Q],standalone:!0})],DemoModalContentComponent);const modal_component_stories={title:"Navigation/Modal",component:ModalComponent,tags:["docs"],decorators:[(0,dist.moduleMetadata)({imports:[ModalComponent,DemoModalTriggerComponent,form_field_component.K,fesm2022_forms.YN],providers:[ModalService]})],argTypes:{closeButton:{control:"boolean"},autofocus:{control:"boolean"},backgroundClose:{control:"boolean"},modalEvent:{table:{disable:!0}},showOnInit:{table:{disable:!0}},returnFocusSelector:{description:"Sélecteur css sur lequel mettre le focus à la fermeture de la modale.\nSi absent alors on met le focus sur la Event.target de l'évènement ayant déclenché l'ouverture de la modale,\n   * si on arrive à l'avoir, sinon sur body.",control:"text"}}},ExempleNominal={name:"Exemple nominal",args:{closeButton:!0,autofocus:!1,backgroundClose:!0,title:"Fenêtre modale générique de l'application",returnFocusSelector:"#champ"},parameters:{docs:{source:{code:DemoModalTriggerComponentTemplate}}},render:args=>({props:args,template:'<demo-modal-trigger\n      [title]="title"\n      [autofocus]="autofocus"\n      [closeButton]="closeButton",\n      [backgroundClose]="backgroundClose"\n      [returnFocusSelector]="returnFocusSelector"\n      />'})},__namedExportsOrder=["DemoModalTriggerComponent","DemoModalContentComponent","ExempleNominal"];ExempleNominal.parameters={...ExempleNominal.parameters,docs:{...ExempleNominal.parameters?.docs,source:{originalSource:'{\n  name: \'Exemple nominal\',\n  args: {\n    closeButton: true,\n    autofocus: false,\n    backgroundClose: true,\n    title: "Fenêtre modale générique de l\'application",\n    returnFocusSelector: \'#champ\'\n  },\n  parameters: {\n    docs: {\n      source: {\n        code: DemoModalTriggerComponentTemplate\n      }\n    }\n  },\n  render: args => ({\n    props: args,\n    template: `<demo-modal-trigger\n      [title]="title"\n      [autofocus]="autofocus"\n      [closeButton]="closeButton",\n      [backgroundClose]="backgroundClose"\n      [returnFocusSelector]="returnFocusSelector"\n      />`\n  })\n}',...ExempleNominal.parameters?.docs?.source}}}}}]);